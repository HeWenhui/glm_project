<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆå®Œæ•´è¯Šæ–­</title>
    <style>
        body {
            margin: 20px;
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        h1 { color: #61dafb; border-bottom: 2px solid #61dafb; padding-bottom: 10px; }
        h2 { color: #f4e28a; margin-top: 30px; }
        .section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #61dafb;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 4px;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; font-weight: bold; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        button {
            margin: 10px 5px;
            padding: 10px 20px;
            background: #61dafb;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover { background: #4ade80; }
        #logs {
            background: #0d0d0d;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 4px;
            font-size: 12px;
        }
        .log-entry { margin: 5px 0; padding: 5px; border-bottom: 1px solid #333; }
        .log-error { color: #f87171; }
        .log-warn { color: #fbbf24; }
        .log-info { color: #60a5fa; }
    </style>
</head>
<body>
    <h1>ğŸ® æ¸¸æˆå®Œæ•´è¯Šæ–­å·¥å…·</h1>

    <div class="section">
        <h2>ç¬¬1æ­¥ï¼šèµ„æºåŠ è½½æµ‹è¯•</h2>

        <div class="status" id="resources-test">
            <div class="info">ç‚¹å‡»å¼€å§‹æµ‹è¯•...</div>
            <button onclick="testResources()">å¼€å§‹æµ‹è¯•</button>
        </div>

        <div id="resource-results"></div>
    </div>

    <div class="section">
        <h2>ç¬¬2æ­¥ï¼šPhaseråˆå§‹åŒ–æµ‹è¯•</h2>

        <div class="status" id="phaser-test">
            <div class="info">ç‚¹å‡»å¼€å§‹æµ‹è¯•...</div>
            <button onclick="testPhaser()">å¼€å§‹æµ‹è¯•</button>
        </div>

        <div id="phaser-results"></div>
    </div>

    <div class="section">
        <h2>ç¬¬3æ­¥ï¼šåœºæ™¯åˆ‡æ¢æµ‹è¯•</h2>

        <div class="status" id="scene-test">
            <div class="info">ç‚¹å‡»å¼€å§‹æµ‹è¯•...</div>
            <button onclick="testScenes()">å¼€å§‹æµ‹è¯•</button>
        </div>

        <div id="scene-results"></div>
    </div>

    <div class="section">
        <h2>ç¬¬4æ­¥ï¼šå®é™…æ¸¸æˆåŠ è½½</h2>

        <div class="warning">
            âš ï¸ å¦‚æœä»¥ä¸Šæµ‹è¯•éƒ½é€šè¿‡ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ è½½å®é™…æ¸¸æˆ
        </div>

        <button onclick="loadActualGame()">ğŸ® åŠ è½½å®é™…æ¸¸æˆ</button>
    </div>

    <div class="section">
        <h2>ğŸ“‹ è¿è¡Œæ—¥å¿—</h2>
        <div id="logs"></div>
    </div>

    <script>
        const logsDiv = document.getElementById('logs');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(entry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function testResources() {
            log('å¼€å§‹èµ„æºåŠ è½½æµ‹è¯•...', 'info');

            const resources = [
                { name: 'player.png', url: 'assets/sprites/player.png' },
                { name: 'ground.png', url: 'assets/images/ground.png' },
                { name: 'platform.png', url: 'assets/images/platform.png' },
                { name: 'enemy.png', url: 'assets/sprites/enemy.png' },
                { name: 'coin.png', url: 'assets/sprites/coin.png' },
                { name: 'particle.png', url: 'assets/sprites/particle.png' },
                { name: 'spark.png', url: 'assets/sprites/spark.png' },
                { name: 'dust.png', url: 'assets/sprites/dust.png' }
            ];

            const resultsDiv = document.getElementById('resource-results');
            resultsDiv.innerHTML = '';

            let successCount = 0;
            let failCount = 0;

            for (const resource of resources) {
                try {
                    const response = await fetch(resource.url, { method: 'HEAD' });
                    const div = document.createElement('div');
                    div.className = 'status';

                    if (response.ok) {
                        div.innerHTML = `<span class="success">âœ“ ${resource.name}</span> (${response.status})`;
                        successCount++;
                    } else {
                        div.innerHTML = `<span class="error">âœ— ${resource.name}</span> (${response.status})`;
                        failCount++;
                        log(`èµ„æºåŠ è½½å¤±è´¥: ${resource.name} - HTTP ${response.status}`, 'error');
                    }
                    resultsDiv.appendChild(div);
                } catch (error) {
                    const div = document.createElement('div');
                    div.className = 'status';
                    div.innerHTML = `<span class="error">âœ— ${resource.name}</span> (${error.message})`;
                    resultsDiv.appendChild(div);
                    failCount++;
                    log(`èµ„æºåŠ è½½å¼‚å¸¸: ${resource.name} - ${error.message}`, 'error');
                }
            }

            const testDiv = document.getElementById('resources-test');
            testDiv.innerHTML = `<span class="success">æµ‹è¯•å®Œæˆ: ${successCount}æˆåŠŸ, ${failCount}å¤±è´¥</span>`;

            log(`èµ„æºæµ‹è¯•å®Œæˆ: ${successCount}ä¸ªæˆåŠŸ, ${failCount}ä¸ªå¤±è´¥`, failCount > 0 ? 'error' : 'success');
        }

        function testPhaser() {
            log('å¼€å§‹Phaseråˆå§‹åŒ–æµ‹è¯•...', 'info');

            const resultsDiv = document.getElementById('phaser-results');
            resultsDiv.innerHTML = '';

            const tests = [];

            // æµ‹è¯•1: Phaseræ˜¯å¦åŠ è½½
            if (typeof Phaser !== 'undefined') {
                const div = document.createElement('div');
                div.className = 'status';
                div.innerHTML = `<span class="success">âœ“ Phaserå·²åŠ è½½ (v${Phaser.VERSION})</span>`;
                resultsDiv.appendChild(div);
                tests.push(true);
                log(`Phaserç‰ˆæœ¬: ${Phaser.VERSION}`, 'info');
            } else {
                const div = document.createElement('div');
                div.className = 'status';
                div.innerHTML = `<span class="error">âœ— PhaseræœªåŠ è½½</span>`;
                resultsDiv.appendChild(div);
                tests.push(false);
                log('Phaseræœªå®šä¹‰', 'error');
            }

            // æµ‹è¯•2: Phaser.Gameåˆ›å»º
            try {
                const game = new Phaser.Game({
                    type: Phaser.AUTO,
                    width: 400,
                    height: 300,
                    parent: 'phaser-test-container',
                    backgroundColor: '#87CEEB',
                    scene: {
                        preload: function() {
                            this.load.image('test', 'assets/images/ground.png');
                        },
                        create: function() {
                            this.add.image(200, 150, 'test');
                            log('Phaser.Gameåˆ›å»ºæˆåŠŸ', 'success');
                        }
                    }
                });

                const div = document.createElement('div');
                div.className = 'status';
                div.innerHTML = `<span class="success">âœ“ Phaser.Gameåˆ›å»ºæˆåŠŸ</span>`;
                resultsDiv.appendChild(div);
                tests.push(true);
            } catch (error) {
                const div = document.createElement('div');
                div.className = 'status';
                div.innerHTML = `<span class="error">âœ— Phaser.Gameåˆ›å»ºå¤±è´¥: ${error.message}</span>`;
                resultsDiv.appendChild(div);
                tests.push(false);
                log(`Phaser.Gameåˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }

            const testDiv = document.getElementById('phaser-test');
            testDiv.innerHTML = `<span class="${tests.every(t => t) ? 'success' : 'error'}">æµ‹è¯•å®Œæˆ: ${tests.filter(t => t).length}/${tests.length}é€šè¿‡</span>`;
        }

        function testScenes() {
            log('å¼€å§‹åœºæ™¯åˆ‡æ¢æµ‹è¯•...', 'info');

            const resultsDiv = document.getElementById('scene-results');
            resultsDiv.innerHTML = '';

            const scenes = ['BootScene', 'MenuScene', 'GameScene', 'UIScene', 'LevelCompleteScene', 'PauseScene'];

            for (const sceneName of scenes) {
                try {
                    const module = await import(`./js/scenes/${sceneName}.js`);
                    const div = document.createElement('div');
                    div.className = 'status';

                    if (module && module.default) {
                        div.innerHTML = `<span class="success">âœ“ ${sceneName}.js æ¨¡å—å¯åŠ è½½</span>`;
                        log(`${sceneName}.js æ¨¡å—åŠ è½½æˆåŠŸ`, 'info');
                    } else {
                        div.innerHTML = `<span class="error">âœ— ${sceneName}.js æ¨¡å—æ— æ•ˆ</span>`;
                        log(`${sceneName}.js æ¨¡å—æ— æ•ˆ`, 'error');
                    }
                    resultsDiv.appendChild(div);
                } catch (error) {
                    const div = document.createElement('div');
                    div.className = 'status';
                    div.innerHTML = `<span class="error">âœ— ${sceneName}.js åŠ è½½å¤±è´¥: ${error.message}</span>`;
                    resultsDiv.appendChild(div);
                    log(`${sceneName}.js åŠ è½½å¼‚å¸¸: ${error.message}`, 'error');
                }
            }

            const testDiv = document.getElementById('scene-test');
            testDiv.innerHTML = `<span class="success">æµ‹è¯•å®Œæˆ</span>`;
        }

        function loadActualGame() {
            if (confirm('ç¡®å®šè¦åŠ è½½å®é™…æ¸¸æˆå—ï¼Ÿè¿™å°†æ›¿æ¢å½“å‰é¡µé¢ã€‚')) {
                window.location.href = 'index.html';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæ—¶çš„åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            log('è¯Šæ–­é¡µé¢åŠ è½½å®Œæˆ', 'info');

            // æ·»åŠ Phaseræµ‹è¯•å®¹å™¨
            const container = document.createElement('div');
            container.id = 'phaser-test-container';
            container.style.cssText = 'margin: 20px auto; border: 2px solid #61dafb;';
            document.body.appendChild(container);

            // æ£€æŸ¥æ˜¯å¦åœ¨HTTPæœåŠ¡å™¨ä¸Šè¿è¡Œ
            if (window.location.protocol === 'file:') {
                log('âš ï¸ è­¦å‘Š: ä½¿ç”¨file://åè®®å¯èƒ½å¯¼è‡´ES6æ¨¡å—åŠ è½½å¤±è´¥', 'warning');
                log('å»ºè®®: ä½¿ç”¨HTTPæœåŠ¡å™¨è¿è¡Œ (npm run dev)', 'warning');
            }
        });

        // å…¨å±€é”™è¯¯æ•è·
        window.addEventListener('error', function(event) {
            log(`å…¨å±€é”™è¯¯: ${event.message} (${event.filename}:${event.lineno})`, 'error');
        });

        window.addEventListener('unhandledrejection', function(event) {
            log(`æœªå¤„ç†çš„Promiseé”™è¯¯: ${event.reason}`, 'error');
        });

        // æ¨¡å—åŠ è½½é”™è¯¯æ•è·
        window.addEventListener('error', function(event) {
            if (event.target && event.target.tagName === 'SCRIPT') {
                log(`è„šæœ¬åŠ è½½å¤±è´¥: ${event.target.src}`, 'error');
            }
        }, true);
    </script>
</body>
</html>
